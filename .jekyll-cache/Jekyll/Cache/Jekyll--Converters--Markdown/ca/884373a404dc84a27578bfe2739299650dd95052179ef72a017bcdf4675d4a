I"Å7<link rel="stylesheet" href="/css/pygments.css" />

<p><a href="http://www.javacodegeeks.com/2013/05/template-method-pattern-using-lambda-expressions-default-methods.html">åŸæ–‡é“¾æ¥</a> ä½œè€…: <a href="http://www.javacodegeeks.com/author/Mohamed-Sanaulla/">Mohamed Sanaulla</a></p>

<p>ã€€ã€€æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯â€œå››äººå¸®â€ï¼ˆè¯‘è€…æ³¨ï¼šErich Gamma, Richard Helm, Ralph Johnson and John Vlissidesï¼‰æ‰€è‘—<a href="http://www.flipkart.com/design-patterns-elements-reusable-object-oriented-software-1st/p/itmdytsswfy3qeqn?pid=9788131700075&amp;affid=INMohamblo">ã€ŠDesign Patterns bookã€‹</a>ä¸€ä¹¦ä¸­æ‰€æè¿°çš„23ç§è®¾è®¡æ¨¡å¼å…¶ä¸­çš„ä¸€ç§ï¼Œè¯¥æ¨¡å¼æ—¨åœ¨ï¼š</p>

<blockquote>
  <p>â€œDefine the skeleton of an algorithm in an operation, deferring some steps to subclasses.
 TemplateMethod lets subclasses redefine certain steps of an algorithm without changing the algorithmâ€™s structureâ€ã€‚</p>
</blockquote>

<p>ã€€ã€€å³æ¨¡æ¿æ–¹æ³•å®šä¹‰ä¸€ä¸ªç®—æ³•çš„æ¶æ„ï¼Œå¹¶å°†æŸäº›æ­¥éª¤æ¨è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚æ¨¡æ¿æ–¹æ³•å…è®¸å­ç±»åœ¨ä¸æ”¹å˜ç®—æ³•æ¶æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­æŸäº›æ­¥éª¤ã€‚</p>

<p>ã€€ã€€ä¸ºäº†ä»¥æ›´ç®€å•çš„æœ¯è¯­æè¿°æ¨¡æ¿æ–¹æ³•ï¼Œè€ƒè™‘è¿™ä¸ªåœºæ™¯ï¼šå‡è®¾åœ¨ä¸€ä¸ªå·¥ä½œæµç³»ç»Ÿä¸­ï¼Œä¸ºäº†å®Œæˆä»»åŠ¡ï¼Œæœ‰4ä¸ªä»»åŠ¡å¿…é¡»ä»¥ç»™å®šçš„æ‰§è¡Œé¡ºåºæ‰§è¡Œã€‚åœ¨è¿™4ä¸ªä»»åŠ¡ä¸­ï¼Œä¸åŒå·¥ä½œæµç³»ç»Ÿçš„å®ç°å¯ä»¥æ ¹æ®è‡ªèº«æƒ…å†µè‡ªå®šä¹‰ä»»åŠ¡çš„æ‰§è¡Œå†…å®¹ã€‚</p>

<p>ã€€ã€€æ¨¡æ¿æ–¹æ³•å¯ä»¥åº”ç”¨åœ¨ä¸Šè¿°åœºæ™¯ä¸­ï¼šå°†å·¥ä½œæµç³»ç»Ÿçš„4ä¸ªæ ¸å¿ƒä»»åŠ¡å°è£…åˆ°æŠ½è±¡ç±»å½“ä¸­ï¼Œå¦‚æœä»»åŠ¡å¯ä»¥è¢«è‡ªå®šä¹‰ï¼Œåˆ™å°†å¯è‡ªå®šä¹‰çš„ä»»åŠ¡æ¨è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚</p>

<!-- more -->

<p>ã€€ã€€ä»£ç å®ç°ï¼š</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/** 
 * Abstract Workflow system 
 */</span>
<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">WorkflowManager2</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask1</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task1..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">doTask2</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">doTask3</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask4</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task4..."</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span>

<span class="cm">/** 
 * One of the extensions of the abstract workflow system 
 */</span>
<span class="kd">class</span> <span class="nc">WorkflowManager2Impl1</span> <span class="kd">extends</span> <span class="nc">WorkflowManager2</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask2</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.1..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask3</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task3.1..."</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span>

<span class="cm">/** 
 * Other extension of the abstract workflow system 
 */</span>
<span class="kd">class</span> <span class="nc">WorkflowManager2Impl2</span> <span class="kd">extends</span> <span class="nc">WorkflowManager2</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask2</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.2..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask3</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task3.2..."</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>ã€€ã€€æˆ‘ä»¬æ¥çœ‹çœ‹å·¥ä½œæµç³»ç»Ÿå¦‚ä½•ä½¿ç”¨ï¼š</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TemplateMethodPattern</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">initiateWorkFlow</span><span class="o">(</span><span class="k">new</span> <span class="nc">WorkflowManager2Impl1</span><span class="o">());</span>

        <span class="n">initiateWorkFlow</span><span class="o">(</span><span class="k">new</span> <span class="nc">WorkflowManager2Impl2</span><span class="o">());</span>

    <span class="o">}</span>

    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">initiateWorkFlow</span><span class="o">(</span><span class="nc">WorkflowManager2</span> <span class="n">workflowMgr</span><span class="o">){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Starting the workflow ... the old way"</span><span class="o">);</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask1</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask2</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask3</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask4</span><span class="o">();</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>ã€€ã€€è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Starting</span> <span class="n">the</span> <span class="n">workflow</span> <span class="o">...</span> <span class="n">the</span> <span class="n">old</span> <span class="n">way</span>

<span class="nc">Doing</span> <span class="nc">Task1</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task2</span><span class="o">.</span><span class="mi">1</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task3</span><span class="o">.</span><span class="mi">1</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task4</span><span class="o">...</span>

<span class="nc">Starting</span> <span class="n">the</span> <span class="n">workflow</span> <span class="o">...</span> <span class="n">the</span> <span class="n">old</span> <span class="n">way</span>

<span class="nc">Doing</span> <span class="nc">Task1</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task2</span><span class="o">.</span><span class="mi">2</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task3</span><span class="o">.</span><span class="mi">2</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task4</span><span class="o">...</span></code></pre></figure>

<p>ã€€ã€€ç›®å‰ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ã€‚ä½†æ˜¯æœ¬ç¯‡åšå®¢çš„ä¸»è¦å…³æ³¨ç‚¹ä¸æ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œè€Œæ˜¯å¦‚ä½•åˆ©ç”¨Java 8çš„Lambdaè¡¨è¾¾å¼å’Œé»˜è®¤æ–¹æ³•å®ç°æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚æˆ‘ä¹‹å‰å·²ç»è¯´è¿‡ï¼Œæ¥å£åªæœ‰åœ¨åªå£°æ˜äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„å‰æä¸‹ï¼Œæ‰å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼ã€‚è¿™ä¸ªè§„åˆ™åœ¨æœ¬ç¯‡çš„ä¾‹å­ä¸­åº”è¿™æ ·è§£é‡Šï¼šWorkflowManager2åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æˆ–è€…è¯´è‡ªå®šä¹‰çš„ä»»åŠ¡ã€‚</p>

<p>ã€€ã€€å¦‚æœä½ ä»ç„¶å¯¹Java 8ä¸­çš„Lambdaè¡¨è¾¾å¼å’Œé»˜è®¤æ–¹æ³•æ„Ÿåˆ°ç–‘æƒ‘ï¼Œå¯ä»¥åœ¨æ·±å…¥ç ”ç©¶ä¹‹å‰ï¼ŒèŠ±ä¸€ç‚¹æ—¶é—´çœ‹ä¸€çœ‹<a href="http://blog.sanaulla.info/2013/03/11/using-lambda-expression-to-sort-a-list-in-java-8-using-netbeans-lambda-support/">Lambdaè¡¨è¾¾å¼</a>å’Œ<a href="http://blog.sanaulla.info/2013/03/20/introduction-to-default-methods-defender-methods-in-java-8/">é»˜è®¤æ–¹æ³•</a>è¿™ä¸¤ç¯‡æ–‡ç« ã€‚</p>

<p>ã€€ã€€æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¸¦æœ‰é»˜è®¤æ–¹æ³•çš„æ¥å£æ›¿ä»£æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ–°å·¥ä½œæµç³»ç»Ÿå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">interface</span> <span class="nc">WorkflowManager</span><span class="o">{</span>

    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">doTask1</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task1..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask2</span><span class="o">();</span>

    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">doTask3</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task3..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">doTask4</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task4..."</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>ã€€ã€€ç°åœ¨æˆ‘ä»¬çš„å·¥ä½œæµç³»ç»Ÿå¸¦æœ‰ä¸€ä¸ªå¯è‡ªå®šä¹‰çš„ä»»åŠ¡2ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°ï¼Œåˆ©ç”¨Lambdaè¡¨è¾¾å¼å¤„ç†åˆå§‹åŒ–å·¥ä½œï¼š</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TemplateMethodPatternLambda</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

       <span class="cm">/**     
        * Using lambda expression to create different      
        * implementation of the abstract workflow 
        */</span>
        <span class="n">initiateWorkFlow</span><span class="o">(()-&gt;</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.1..."</span><span class="o">));</span>

        <span class="n">initiateWorkFlow</span><span class="o">(()-&gt;</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.2..."</span><span class="o">));</span>

        <span class="n">initiateWorkFlow</span><span class="o">(()-&gt;</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.3..."</span><span class="o">));</span>

    <span class="o">}</span>

    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">initiateWorkFlow</span><span class="o">(</span><span class="nc">WorkflowManager</span> <span class="n">workflowMgr</span><span class="o">){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Starting the workflow ..."</span><span class="o">);</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask1</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask2</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask3</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask4</span><span class="o">();</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>ã€€ã€€è¿™å°±æ˜¯ä¸€ä¸ªLambdaè¡¨è¾¾å¼åº”ç”¨åœ¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­çš„ä¾‹å­ã€‚</p>
:ET