<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Derrick Lee's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="combine-header">
                <a class="navbar-brand" href="/">Derrick Lee's Blog</a>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="/">Home</a></li>
                        <li class="active visible-xs-block"><a href="/links.html">Links</a></li>
                        <li class="active"><a href="/archive.html">Archive</a></li>
                        <li class="active"><a href="/categories.html">Categories</a></li>
                        <li class="active"><a href="/tags.html">Tags</a></li>
                        <li class="active"><a href="/about.html">About</a></li>
                        
                        <li class="active"><a href="https://github.com/leesir/leesir.github.io">Github</a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="container container-left">
    <div class="row">
        <div class="col-md-3 hidden-xs">
            <div class="sidebar well">
    <h4>Stay foolish, Stay ugly</h4>
</div>

<div class="sidebar well">
    <h1>Recent Posts</h1>
    <ul>
        
        <li><a href="/2019/09/prod-jvm-params">生产环境JVM参数配置记录（一）</a></li>
        
        <li><a href="/2019/08/bug-1">工作问题记录（一）：事务的错误使用方式</a></li>
        
        <li><a href="/2019/07/accurate-money">一种精确的理财金额算法的设计与实现（以等额本息为例）</a></li>
        
        <li><a href="/2019/07/java-sugar-generic-relate">Java语法糖-泛型-类关系</a></li>
        
        <li><a href="/2019/07/java-sugar-generic-wildcard">Java语法糖-泛型-通配符</a></li>
        
        <li><a href="/2019/07/java-sugar-generic-bound">Java语法糖-泛型-泛型边界</a></li>
        
        <li><a href="/2019/07/java-sugar-generic-type-erasure">Java语法糖-泛型-类型擦除</a></li>
        
        <li><a href="/2019/07/java-sugar-generic">Java语法糖-泛型</a></li>
        
        <li><a href="/2019/06/cache-pattern-practise">缓存更新策略实践</a></li>
        
        <li><a href="/2019/06/java-javasuger-cc">Java语法糖-条件编译</a></li>
        
        <li><a href="/2019/06/java-assert">Java语法糖-assert</a></li>
        
        <li><a href="/2019/06/system-logincache">一种基于redis的登录态的设计与实现</a></li>
        
        <li><a href="/2019/06/java-javasuger-innerclass">Java语法糖-内部类</a></li>
        
        <li><a href="/2019/06/java-javasuger">Java语法糖</a></li>
        
        <li><a href="/2016/08/java-history">Java的历史</a></li>
        
    </ul>
</div>

<div class="sidebar well">
    <h1>Links</h1>
<ul>
  <li><a href="http://ifeve.com/" target="_blank">并发编程网</a></li>
  <li><a href="http://www.infoq.com/cn" target="_blank">InfoQ</a></li>
</ul>

</div>

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_1277778288'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1277778288%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
        </div>
        <div class="col-md-9">
            <div class="article">
                <div class="well">
                    <h1><a href="/2019/09/prod-jvm-params">生产环境JVM参数配置记录（一）</a></h1>
                    <br>
                    
                    <div class="post-content">
                        <link rel="stylesheet" href="/css/pygments.css" />

<p>       本文记录笔者参与的某Java服务的JVM启动参数。</p>

<p><br /></p>

<h4 id="-djavaawtheadlesstrue">-Djava.awt.headless=true</h4>

<p>       从JDk1.4起，可以通过此参数以无外设（显示器、键盘等）模式运行JVM实例。无外设模式下，代码中仅能使用部分GUI组件，比如Canvas类。
当使用了Button和Frame等依赖于显示设备的类时，将会抛出HeadlessException。</p>

<p>       当然，在Java服务端开发中，不会用到java.awt.*的类，使用此参数可以防止误拷贝了Java GUI开发的代码所引发的问题。</p>

<p><br /></p>

<h4 id="-djavanetpreferipv4stacktrue">-Djava.net.preferIPv4Stack=true</h4>

<p>       此参数默认为false，如果操作系统支持IPv6，JVM可以与IPv4及IPv6的主机进行socket通信。
设置为true，则告诉JVM仅允许与IPv4的主机进行socket通信。</p>

<p><br /></p>

<p class="center"><img src="/images/post_2019_09_05_image1.png" alt="c compile" /></p>

<p class="center"><a href="https://technology.amis.nl/2018/12/09/jvm-performance-openj9-uses-least-memory-graalvm-most-openjdk-distributions-differ/">图片来源</a></p>

<!-- more -->

<p><br /></p>

<h4 id="-server">-server</h4>

<p>       告诉JVM以服务器模式运行，目前64位操作系统仅有server模式。相对于client模式，server模式的初始堆和运行时垃圾回收都会不同，
不关注启动速度，关注运行时的效率和优化。</p>

<p><br /></p>

<h4 id="-xmx2048m--xms2048m">-Xmx2048M -Xms2048M</h4>

<p>       Xms为初始堆配置，Xmx为最大堆配置，此配置告诉JVM初始化一个大小为2G的堆。通常将这两个参数设置为一样，避免JVM在运行时动态申请或者缩减堆的大小。</p>

<p><br /></p>

<h4 id="-xmn1024m">-Xmn1024M</h4>

<p>       此参数设置新生代为1G，新生代既不能太大也不能太小，否则会导致GC性能不佳。<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html">官方文档</a>
推荐的新生代大小为整堆的1/4~1/2。</p>

<p><br /></p>

<h4 id="-xxsurvivorratio7">-XX:SurvivorRatio=7</h4>

<p>       设置新生代中EDEN和1个survivor的比例，默认值为8，既新生代等于10个survivor的大小。此命令完全可以不用设置，沿用默认值即可。</p>

<p><br /></p>

<h4 id="-xss256k">-Xss256k</h4>

<p>       设置线程栈大小为256k。这个值没有明确的标准，通常建议32位JVM设置为128k，64位JVM设置为256k。
在某些环境下，Xss设置过大或者过小，启动会失败，比如提示“The stack size specified is too small, Specify at least 228k”。</p>

<p><br /></p>

<h4 id="-xxpermsize128m---xxmaxpermsize256m">-XX:PermSize=128M  -XX:MaxPermSize=256m</h4>

<p>       设置永久代初始容量和最大容量，由于JDK1.8之后，运行时内存取消了永久代区域，所以这两个参数在JDk1.8及以后版本被弃用。
可以用-XX:MetaspaceSize和-XX:MaxMetaspaceSize参数作为替代。</p>

<p><br /></p>

<h4 id="-xxuseconcmarksweepgc--xxuseparnewgc">-XX:+UseConcMarkSweepGC -XX:+UseParNewGC</h4>

<p>       设置新生代ParNew和老年代CMS的垃圾收集器组合。默认情况下-XX:+UseConcMarkSweepGC是关闭的，如果没有显示设置垃圾收集器，JVM将会自动挑选组合。
另外也可以关注一下G1收集器，JDK1.8版本以后，-XX:+UseG1GC参数可以启用G1收集器。</p>

<p><br /></p>

<h4 id="-xxusecmsinitiatingoccupancyonly--xxcmsinitiatingoccupancyfraction80">-XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=80</h4>

<p>       开启UseCMSInitiatingOccupancyOnly标识之后，JVM始终以预设的堆内存使用比例为条件，启动CMS收集器。
默认情况下UseCMSInitiatingOccupancyOnly标识为关闭状态，由JVM自行决策，除非有明确的理由，否则不建议开启此标志。</p>

<p>       XX:CMSInitiatingOccupancyFraction=80预设当堆内存使用率达80%时，启动CMS收集器。需要注意的时，CMS是并发收集器，
执行过程中应用程序依然会产生许多垃圾，当老年代新增的垃圾速度大于回收的速度时，则可能会导致CMS收集器的“concurrent mode failure”，会临时启用老年代单线程Serial Old收集器进行收集工作，停顿时间会更长。
所以应结合实际情况，适当调整CMSInitiatingOccupancyFraction的阈值。</p>

<p><br /></p>

<h4 id="-xxusecmscompactatfullcollection--xxcmsfullgcsbeforecompaction5">-XX:+UseCMSCompactAtFullCollection -XX:CMSFullGCsBeforeCompaction=5</h4>

<p>       CMS收集器采用“标记-清理”算法，在回收完成之后，必定会存在内存碎片。
UseCMSCompactAtFullCollection标志默认开启，表示在CMS回收之后进行内存压缩整理，而整理过程无法并发，所以必定会造成停顿。</p>

<p>       -XX:CMSFullGCsBeforeCompaction=5表示在5次CMS回收之后，启动内存压缩整理。当设置为0时，表示每次回收之后都进行内存压缩整理。
应结合生产环境的情况，适当配置CMSFullGCsBeforeCompaction的值。</p>

<p><br /></p>

<h4 id="-xxmaxtenuringthreshold10">-XX:MaxTenuringThreshold=10</h4>

<p>       设置新生代对象进入老年代的年龄。-XX:MaxTenuringThreshold=10，当新生代对象经过10次垃圾回收之后依然存活，则晋升至老年代。
如果不进行预设，不同垃圾收集器有不同的默认值，比如Parallel Scavenge默认值为15，CMS默认值为6。</p>

<p><br /></p>

<h4 id="-xxdisableexplicitgc">-XX:+DisableExplicitGC</h4>

<p>       开启此标识，忽略System.gc()。实际编码过程中，也不应该显示调用System.gc()，把垃圾回收的任务委托给JVM即可。</p>

<p><br /></p>

<h4 id="-xnoclassgc">-Xnoclassgc</h4>

<p>       开启此标识后，垃圾回收器忽略对类对象的回收，应用程序所加载的所有类对象都会被认为是存活的，会在一定程度上节省GC时间。
然而如果应用导入了大量的JAR，大量使用JSP文件或者动态代理、反射等技术，内存中会保存大量的Class对象，长期运行的服务很可能会内存溢出。</p>

<p><br /></p>

<h2 id="参考文献">参考文献</h2>

<p>[1] Artem Ananiev.<a href="https://www.oracle.com/technetwork/articles/javase/headless-136834.html">Using Headless Mode in the Java SE Platform</a>[EB/OL].https://www.oracle.com/technetwork/articles/javase/headless-136834.html，2019-09-05.<br />
[2] <a href="https://docs.oracle.com/javase/6/docs/technotes/guides/net/ipv6_guide/">Networking IPv6 User Guide for JDK/JRE 5.0</a>[EB/OL].https://docs.oracle.com/javase/6/docs/technotes/guides/net/ipv6_guide/，2019-09-05.<br />
[3] <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html">Java Platform, Standard Edition Tools Reference</a>[EB/OL].https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html，2019-09-05.<br /></p>

                    </div>
                    
                </div>
            </div>
            <div class="pagination">
                
                
                <a class="btn btn-default" href="/2019/08/bug-1" class="previous">Older
                    Post</a>
                
            </div>
        </div>
    </div>

    

    <div class="container-fluid">
    <div class="row-fluid">
        <div class="span12 footer navbar-inverse navbar-fixed-bottom">
            <p class="copyright">&copy;2019 Derrick Lee's Blog. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="https://github.com/scotte/jekyll-clean">Scott Emmons</a>
            under
            <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution</a></p>
        </div>
    </div>
</div>






</body>
</html>


</div>