<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Derrick Lee's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="combine-header">
                <a class="navbar-brand" href="/">Derrick Lee's Blog</a>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="/">Home</a></li>
                        <li class="active visible-xs-block"><a href="/links.html">Links</a></li>
                        <li class="active"><a href="/archive.html">Archive</a></li>
                        <li class="active"><a href="/categories.html">Categories</a></li>
                        <li class="active"><a href="/tags.html">Tags</a></li>
                        <li class="active"><a href="/about.html">About</a></li>
                        
                        <li class="active"><a href="https://github.com/leesir/leesir.github.io">Github</a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="container container-left">
    <div class="row">
        <div class="col-md-3 hidden-xs">
            <div class="sidebar well">
    <h4>Stay foolish, Stay ugly</h4>
</div>

<div class="sidebar well">
    <h1>Recent Posts</h1>
    <ul>
        
        <li><a href="/2019/07/java-sugar-generic-wildcard">Java语法糖-泛型-通配符</a></li>
        
        <li><a href="/2019/07/java-sugar-generic-bound">Java语法糖-泛型-泛型边界</a></li>
        
        <li><a href="/2019/07/java-sugar-generic-type-erasure">Java语法糖-泛型-类型擦除</a></li>
        
        <li><a href="/2019/07/java-sugar-generic">Java语法糖-泛型</a></li>
        
        <li><a href="/2019/06/cache-pattern-practise">缓存更新策略实践</a></li>
        
        <li><a href="/2019/06/java-javasuger-cc">Java语法糖-条件编译</a></li>
        
        <li><a href="/2019/06/java-assert">Java语法糖-assert</a></li>
        
        <li><a href="/2019/06/system-logincache">一种基于redis的登录态的设计与实现</a></li>
        
        <li><a href="/2019/06/java-javasuger-innerclass">Java语法糖-内部类</a></li>
        
        <li><a href="/2019/06/java-javasuger">Java语法糖</a></li>
        
        <li><a href="/2016/08/java-history">Java的历史</a></li>
        
        <li><a href="/2016/07/java-history-beginning-words">Java历史开篇语</a></li>
        
        <li><a href="/2016/07/project-summary-2">项目总结-2016年07月11日</a></li>
        
        <li><a href="/2016/07/project-summary-1">Project Summary 1</a></li>
        
        <li><a href="/2016/07/summary-synchronized-error">对包装类型变量使用synchronized不当造成的同步不正确</a></li>
        
    </ul>
</div>

<div class="sidebar well">
    <h1>Links</h1>
<ul>
  <li><a href="http://ifeve.com/" target="_blank">并发编程网</a></li>
  <li><a href="http://www.infoq.com/cn" target="_blank">InfoQ</a></li>
</ul>

</div>

<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_1277778288'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1277778288%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
        </div>
        <div class="col-md-9">
            <div class="article">
                <div class="well">
                    <h1><a href="/2015/10/java-fp-java8-lambda-template">采用Java 8中Lambda表达式和默认方法的模板方法模式</a></h1>
                    <br>
                    
                    <div class="post-content">
                        <link rel="stylesheet" href="/css/pygments.css" />

<p><a href="http://www.javacodegeeks.com/2013/05/template-method-pattern-using-lambda-expressions-default-methods.html">原文链接</a> 作者: <a href="http://www.javacodegeeks.com/author/Mohamed-Sanaulla/">Mohamed Sanaulla</a></p>

<p>　　模板方法模式是“四人帮”（译者注：Erich Gamma, Richard Helm, Ralph Johnson and John Vlissides）所著<a href="http://www.flipkart.com/design-patterns-elements-reusable-object-oriented-software-1st/p/itmdytsswfy3qeqn?pid=9788131700075&amp;affid=INMohamblo">《Design Patterns book》</a>一书中所描述的23种设计模式其中的一种，该模式旨在：</p>

<blockquote>
  <p>“Define the skeleton of an algorithm in an operation, deferring some steps to subclasses.
 TemplateMethod lets subclasses redefine certain steps of an algorithm without changing the algorithm’s structure”。</p>
</blockquote>

<p>　　即模板方法定义一个算法的架构，并将某些步骤推迟到子类中实现。模板方法允许子类在不改变算法架构的情况下，重新定义算法中某些步骤。</p>

<p>　　为了以更简单的术语描述模板方法，考虑这个场景：假设在一个工作流系统中，为了完成任务，有4个任务必须以给定的执行顺序执行。在这4个任务中，不同工作流系统的实现可以根据自身情况自定义任务的执行内容。</p>

<p>　　模板方法可以应用在上述场景中：将工作流系统的4个核心任务封装到抽象类当中，如果任务可以被自定义，则将可自定义的任务推迟到子类中实现。</p>

<!-- more -->

<p>　　代码实现：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/** 
 * Abstract Workflow system 
 */</span>
<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">WorkflowManager2</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask1</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task1..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">doTask2</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">doTask3</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask4</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task4..."</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span>

<span class="cm">/** 
 * One of the extensions of the abstract workflow system 
 */</span>
<span class="kd">class</span> <span class="nc">WorkflowManager2Impl1</span> <span class="kd">extends</span> <span class="nc">WorkflowManager2</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask2</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.1..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask3</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task3.1..."</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span>

<span class="cm">/** 
 * Other extension of the abstract workflow system 
 */</span>
<span class="kd">class</span> <span class="nc">WorkflowManager2Impl2</span> <span class="kd">extends</span> <span class="nc">WorkflowManager2</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask2</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.2..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask3</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task3.2..."</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>　　我们来看看工作流系统如何使用：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TemplateMethodPattern</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">initiateWorkFlow</span><span class="o">(</span><span class="k">new</span> <span class="nc">WorkflowManager2Impl1</span><span class="o">());</span>

        <span class="n">initiateWorkFlow</span><span class="o">(</span><span class="k">new</span> <span class="nc">WorkflowManager2Impl2</span><span class="o">());</span>

    <span class="o">}</span>

    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">initiateWorkFlow</span><span class="o">(</span><span class="nc">WorkflowManager2</span> <span class="n">workflowMgr</span><span class="o">){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Starting the workflow ... the old way"</span><span class="o">);</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask1</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask2</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask3</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask4</span><span class="o">();</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>　　输出如下所示：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">Starting</span> <span class="n">the</span> <span class="n">workflow</span> <span class="o">...</span> <span class="n">the</span> <span class="n">old</span> <span class="n">way</span>

<span class="nc">Doing</span> <span class="nc">Task1</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task2</span><span class="o">.</span><span class="mi">1</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task3</span><span class="o">.</span><span class="mi">1</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task4</span><span class="o">...</span>

<span class="nc">Starting</span> <span class="n">the</span> <span class="n">workflow</span> <span class="o">...</span> <span class="n">the</span> <span class="n">old</span> <span class="n">way</span>

<span class="nc">Doing</span> <span class="nc">Task1</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task2</span><span class="o">.</span><span class="mi">2</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task3</span><span class="o">.</span><span class="mi">2</span><span class="o">...</span>

<span class="nc">Doing</span> <span class="nc">Task4</span><span class="o">...</span></code></pre></figure>

<p>　　目前为止一切顺利。但是本篇博客的主要关注点不是模板方法模式，而是如何利用Java 8的Lambda表达式和默认方法实现模板方法模式。我之前已经说过，接口只有在只声明了一个抽象方法的前提下，才可以使用Lambda表达式。这个规则在本篇的例子中应这样解释：WorkflowManager2只能有一个抽象或者说自定义的任务。</p>

<p>　　如果你仍然对Java 8中的Lambda表达式和默认方法感到疑惑，可以在深入研究之前，花一点时间看一看<a href="http://blog.sanaulla.info/2013/03/11/using-lambda-expression-to-sort-a-list-in-java-8-using-netbeans-lambda-support/">Lambda表达式</a>和<a href="http://blog.sanaulla.info/2013/03/20/introduction-to-default-methods-defender-methods-in-java-8/">默认方法</a>这两篇文章。</p>

<p>　　我们可以利用带有默认方法的接口替代抽象类，所以我们的新工作流系统如下所示：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">interface</span> <span class="nc">WorkflowManager</span><span class="o">{</span>

    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">doTask1</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task1..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doTask2</span><span class="o">();</span>

    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">doTask3</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task3..."</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="k">default</span> <span class="kt">void</span> <span class="nf">doTask4</span><span class="o">(){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task4..."</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>　　现在我们的工作流系统带有一个可自定义的任务2，我们继续往下走，利用Lambda表达式处理初始化工作：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TemplateMethodPatternLambda</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

       <span class="cm">/**     
        * Using lambda expression to create different      
        * implementation of the abstract workflow 
        */</span>
        <span class="n">initiateWorkFlow</span><span class="o">(()-&gt;</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.1..."</span><span class="o">));</span>

        <span class="n">initiateWorkFlow</span><span class="o">(()-&gt;</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.2..."</span><span class="o">));</span>

        <span class="n">initiateWorkFlow</span><span class="o">(()-&gt;</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Doing Task2.3..."</span><span class="o">));</span>

    <span class="o">}</span>

    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">initiateWorkFlow</span><span class="o">(</span><span class="nc">WorkflowManager</span> <span class="n">workflowMgr</span><span class="o">){</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Starting the workflow ..."</span><span class="o">);</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask1</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask2</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask3</span><span class="o">();</span>

        <span class="n">workflowMgr</span><span class="o">.</span><span class="na">doTask4</span><span class="o">();</span>

    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>　　这就是一个Lambda表达式应用在模板方法模式中的例子。</p>

                    </div>
                    
                </div>
            </div>
            <div class="pagination">
                
                <a class="btn btn-default" href="/2015/10/java-fp-java8-lambda" class="next">Newer Post</a>
                
                
                <a class="btn btn-default" href="/2015/10/java-fp-java8-predicate-consumer" class="previous">Older
                    Post</a>
                
            </div>
        </div>
    </div>

    

    <div class="container-fluid">
    <div class="row-fluid">
        <div class="span12 footer navbar-inverse navbar-fixed-bottom">
            <p class="copyright">&copy;2019 Derrick Lee's Blog. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="https://github.com/scotte/jekyll-clean">Scott Emmons</a>
            under
            <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution</a></p>
        </div>
    </div>
</div>






</body>
</html>


</div>